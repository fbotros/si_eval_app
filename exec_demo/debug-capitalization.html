<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Capitalization Issue</title>
</head>
<body>
    <h1>Debug Capitalization Issue</h1>
    <p>Testing "Readyfor" → "Ready for" capitalization preservation</p>
    
    <button onclick="testCapitalization()">Test Capitalization</button>
    <div id="results"></div>

    <!-- Load dependencies -->
    <script src="dictionary-loader.js"></script>
    <script src="keyboard-layout.js"></script>
    <script src="TrieDictionary.js"></script>
    <script src="AutocorrectEngine.js"></script>

    <script>
        let engine = null;

        async function initializeEngine() {
            const dictionary = await loadDictionary();
            engine = new AutocorrectEngine({
                baseWords: dictionary,
                keyboardNeighbors: typeof keyboardNeighbors !== 'undefined' ? keyboardNeighbors : {},
                maxEditDistance: 2,
                adjacentKeyMultiplier: 0.4
            });
        }

        async function testCapitalization() {
            if (!engine) {
                await initializeEngine();
            }

            const resultsDiv = document.getElementById('results');
            let output = '<h2>Capitalization Debug Results</h2>';

            // Test the problematic case
            const testWord = 'Readyfor';
            output += `<h3>Testing: "${testWord}"</h3>`;

            // Check if individual words are in dictionary
            const hasReady = engine.hasWord('ready');
            const hasFor = engine.hasWord('for');
            output += `<p>Dictionary contains "ready": ${hasReady}</p>`;
            output += `<p>Dictionary contains "for": ${hasFor}</p>`;

            // Test the correction
            const corrected = engine.findClosestWord(testWord);
            output += `<p><strong>Final result: "${testWord}" → "${corrected}"</strong></p>`;

            // Test two-word split directly
            const twoWordSplit = engine.findTwoWordSplit(testWord);
            output += `<p>Two-word split result: "${twoWordSplit}"</p>`;

            // Test single word correction
            const singleWordCorrection = engine.findBestCorrectionForPart(testWord.toLowerCase());
            output += `<p>Single word correction: "${singleWordCorrection}"</p>`;

            // Test capitalization preservation function directly
            const preservedCap = engine.preserveCapitalization(testWord, 'ready for');
            output += `<p>Preserved capitalization: "${preservedCap}"</p>`;

            // Additional test cases
            const testCases = [
                'Helloworld',
                'HELLOWORLD', 
                'helloworld',
                'Readyfor',
                'READYFOR',
                'readyfor',
                'Goodmorning',
                'GOODMORNING',
                'goodmorning'
            ];

            output += '<h3>Additional Test Cases (Should All Work Now!)</h3>';
            for (const test of testCases) {
                const result = engine.findClosestWord(test);
                const correct = (test === 'HELLOWORLD' && result === 'HELLO WORLD') ||
                               (test === 'READYFOR' && result === 'READY FOR') ||
                               (test === 'GOODMORNING' && result === 'GOOD MORNING') ||
                               (test.toLowerCase() !== result.toLowerCase());
                const icon = correct ? '✅' : '❌';
                output += `<p>${icon} "${test}" → "${result}"</p>`;
            }

            resultsDiv.innerHTML = output;
        }

        // Auto-initialize
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(testCapitalization, 500);
        });
    </script>
</body>
</html>