<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fadi's 30-Second Typing Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            width: 80%;
            max-width: 800px;
            padding: 2rem;
            border-radius: 10px;
            background-color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 1.5rem;
        }
        .test-container {
            margin-bottom: 1.5rem;
        }
        .sample-text {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            line-height: 1.6;
            border-left: 4px solid #3498db;
        }
        .input-area {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            resize: none;
            margin-bottom: 1rem;
            transition: border-color 0.3s;
        }
        .input-area:focus {
            outline: none;
            border-color: #3498db;
        }
        .input-area.disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
        .timer {
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .button {
            display: block;
            width: 200px;
            margin: 0 auto;
            padding: 0.8rem;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #2980b9;
        }
        .button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        .results {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 5px;
            display: none;
        }
        .results h2 {
            margin-top: 0;
            color: #2c3e50;
        }
        .metric {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }
        .metric span {
            font-weight: bold;
            color: #3498db;
        }
        .instructions {
            text-align: center;
            margin-bottom: 1rem;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fadi's 30-Second Typing Test</h1>
        <p class="instructions">Start typing in the box below to begin the 30-second test. Smart autocorrect is enabled - it will fix typos using an edit distance of up to 2 when you press space or punctuation. After the test ends, results will be downloaded as a JSON file.</p>

        <div class="test-container">
            <div class="sample-text" id="sample-text">
                The quick brown fox jumps over the lazy dog. Programming is the process of creating a set of instructions that tell a computer how to perform a task. Programming can be done using a variety of computer programming languages, such as JavaScript, Python, and C++.
            </div>

            <textarea class="input-area" id="input-area" placeholder="Start typing here..."></textarea>

            <div class="timer" id="timer">Time: 30s</div>

            <button class="button" id="start-button">Reset Test</button>
        </div>

        <div class="results" id="results">
            <h2>Your Results</h2>
            <div class="metric">Words per minute: <span id="wpm">0</span></div>
            <div class="metric">Characters per minute: <span id="cpm">0</span></div>
            <div class="metric">Accuracy: <span id="accuracy">0%</span></div>
            <div class="metric">Correct characters: <span id="correct-chars">0</span></div>
            <div class="metric">Incorrect characters: <span id="incorrect-chars">0</span></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const sampleText = document.getElementById('sample-text').innerText;
            const inputArea = document.getElementById('input-area');
            const timer = document.getElementById('timer');
            const startButton = document.getElementById('start-button');
            const results = document.getElementById('results');
            const wpmElement = document.getElementById('wpm');
            const cpmElement = document.getElementById('cpm');
            const accuracyElement = document.getElementById('accuracy');
            const correctCharsElement = document.getElementById('correct-chars');
            const incorrectCharsElement = document.getElementById('incorrect-chars');

            let timeLeft = 30;
            let timerInterval;
            let testActive = false;

            // Function to start the test
            function startTest() {
                if (testActive) return;

                // Start the test
                testActive = true;
                results.style.display = 'none';

                // Start the timer
                timeLeft = 30;
                updateTimerDisplay();
                timerInterval = setInterval(function() {
                    timeLeft--;
                    updateTimerDisplay();

                    if (timeLeft <= 0) {
                        endTest();
                    }
                }, 1000);
            }

            // Dictionary of common words
            const dictionary = [
                // Words from the sample text
                'the', 'quick', 'brown', 'fox', 'jumps', 'over', 'lazy', 'dog',
                'programming', 'is', 'process', 'of', 'creating', 'set', 'instructions',
                'that', 'tell', 'computer', 'how', 'to', 'perform', 'task', 'can', 'be',
                'done', 'using', 'variety', 'languages', 'such', 'as', 'javascript', 'python', 'and',

                // Common English words
                'a', 'an', 'in', 'on', 'at', 'by', 'for', 'with', 'about', 'against',
                'between', 'into', 'through', 'during', 'before', 'after', 'above', 'below',
                'from', 'up', 'down', 'out', 'off', 'over', 'under', 'again', 'further',
                'then', 'once', 'here', 'there', 'when', 'where', 'why', 'how', 'all',
                'any', 'both', 'each', 'few', 'more', 'most', 'some', 'other', 'have',
                'has', 'had', 'do', 'does', 'did', 'but', 'if', 'or', 'because', 'until',
                'while', 'of', 'this', 'these', 'those', 'am', 'are', 'was', 'were',

                // Programming related words
                'function', 'variable', 'code', 'program', 'class', 'object', 'method',
                'array', 'string', 'number', 'boolean', 'null', 'undefined', 'syntax',
                'error', 'debug', 'compile', 'runtime', 'framework', 'library', 'api',
                'interface', 'module', 'component', 'server', 'client', 'database', 'data',
                'file', 'system', 'network', 'web', 'app', 'application', 'development'
            ];

            // Calculate Levenshtein distance between two strings
            function levenshteinDistance(a, b) {
                if (a.length === 0) return b.length;
                if (b.length === 0) return a.length;

                const matrix = [];

                // Initialize matrix
                for (let i = 0; i <= b.length; i++) {
                    matrix[i] = [i];
                }

                for (let j = 0; j <= a.length; j++) {
                    matrix[0][j] = j;
                }

                // Fill in the rest of the matrix
                for (let i = 1; i <= b.length; i++) {
                    for (let j = 1; j <= a.length; j++) {
                        if (b.charAt(i - 1) === a.charAt(j - 1)) {
                            matrix[i][j] = matrix[i - 1][j - 1];
                        } else {
                            matrix[i][j] = Math.min(
                                matrix[i - 1][j - 1] + 1, // substitution
                                matrix[i][j - 1] + 1,     // insertion
                                matrix[i - 1][j] + 1      // deletion
                            );
                        }
                    }
                }

                return matrix[b.length][a.length];
            }

            // Find the closest word in the dictionary
            function findClosestWord(word) {
                // If the word is already in the dictionary, return it
                if (dictionary.includes(word)) {
                    return word;
                }

                let closestWord = null;
                let minDistance = Infinity;

                // Find words with edit distance of up to 2
                for (const dictWord of dictionary) {
                    const distance = levenshteinDistance(word, dictWord);

                    // Consider words with edit distance of 1 or 2
                    if (distance <= 2 && distance < minDistance) {
                        minDistance = distance;
                        closestWord = dictWord;
                    }
                }

                // Return the closest word if found, otherwise return the original word
                return closestWord || word;
            }

            // Start test when user starts typing
            inputArea.addEventListener('input', function(e) {
                if (!testActive) {
                    startTest();
                }
            });

            // Function to perform autocorrect
            function performAutocorrect(appendChar) {
                const text = inputArea.value;
                if (text.length > 0) {
                    // Get the last word
                    const words = text.trim().split(/[\s.,!?;:"'()]/);
                    const lastWord = words[words.length - 1].toLowerCase();

                    // Skip very short words (1-2 characters)
                    if (lastWord.length > 2) {
                        // Find the closest word in the dictionary
                        const correctedWord = findClosestWord(lastWord);

                        // If a correction was found and it's different from the original word
                        if (correctedWord !== lastWord) {
                            // Replace the last word with the corrected one
                            const lastIndex = text.lastIndexOf(lastWord);
                            if (lastIndex !== -1) {
                                const newText = text.substring(0, lastIndex) + correctedWord;

                                // Update the input area with the corrected text
                                setTimeout(() => {
                                    inputArea.value = newText + appendChar;

                                    // Move cursor to the end
                                    inputArea.selectionStart = inputArea.value.length;
                                    inputArea.selectionEnd = inputArea.value.length;
                                }, 0);

                                return true; // Correction was made
                            }
                        }
                    }
                }
                return false; // No correction was made
            }

            // Add autocorrect functionality
            inputArea.addEventListener('keydown', function(e) {
                if (!testActive) return;

                // Check for space or punctuation
                const punctuation = [' ', '.', ',', '!', '?', ';', ':', '"', "'", '(', ')'];

                if (punctuation.includes(e.key)) {
                    // Perform autocorrect and append the pressed character
                    performAutocorrect(e.key);
                }
            });

            // Reset button functionality
            startButton.addEventListener('click', function() {
                resetTest();
            });

            function updateTimerDisplay() {
                timer.textContent = `Time: ${timeLeft}s`;
            }

            function endTest() {
                clearInterval(timerInterval);
                testActive = false;

                // Disable the input area so users can't type anymore
                inputArea.disabled = true;

                // Change button text
                startButton.textContent = 'Start New Test';

                // Calculate results
                calculateResults();

                // Display results
                results.style.display = 'block';
            }

            function resetTest() {
                clearInterval(timerInterval);
                testActive = false;
                timeLeft = 30;
                updateTimerDisplay();
                inputArea.value = '';
                inputArea.disabled = false;
                startButton.textContent = 'Reset Test';
                results.style.display = 'none';
            }

            function calculateResults() {
                const typedText = inputArea.value;
                const typedLength = typedText.length;

                // Calculate correct and incorrect characters
                let correctChars = 0;
                let incorrectChars = 0;

                for (let i = 0; i < typedLength; i++) {
                    if (i < sampleText.length && typedText[i] === sampleText[i]) {
                        correctChars++;
                    } else {
                        incorrectChars++;
                    }
                }

                // Calculate accuracy
                const accuracy = typedLength > 0 ? Math.floor((correctChars / typedLength) * 100) : 0;

                // Calculate WPM (assuming average word length of 5 characters)
                const minutes = (30 - timeLeft) / 60;
                const words = correctChars / 5;
                const wpm = minutes > 0 ? Math.floor(words / minutes) : 0;

                // Calculate CPM
                const cpm = minutes > 0 ? Math.floor(correctChars / minutes) : 0;

                // Update results display
                wpmElement.textContent = wpm;
                cpmElement.textContent = cpm;
                accuracyElement.textContent = `${accuracy}%`;
                correctCharsElement.textContent = correctChars;
                incorrectCharsElement.textContent = incorrectChars;

                // Create results object
                const resultsData = {
                    date: new Date().toISOString(),
                    wpm: wpm,
                    cpm: cpm,
                    accuracy: accuracy,
                    correctChars: correctChars,
                    incorrectChars: incorrectChars,
                    totalChars: typedLength,
                    testDuration: 30
                };

                // Download results as JSON
                downloadResultsAsJson(resultsData);
            }

            function downloadResultsAsJson(data) {
                // Create a JSON string from the data
                const jsonString = JSON.stringify(data, null, 2);

                // Create a Blob with the JSON data
                const blob = new Blob([jsonString], { type: 'application/json' });

                // Create a URL for the Blob
                const url = URL.createObjectURL(blob);

                // Create a temporary link element
                const link = document.createElement('a');
                link.href = url;

                // Set the filename with date
                const date = new Date();
                const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                link.download = `typing-test-results-${formattedDate}.json`;

                // Append the link to the body
                document.body.appendChild(link);

                // Trigger the download
                link.click();

                // Clean up
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            }
        });
    </script>
</body>
</html>
